# Municipal Ethics Code Scraper - Architecture

## Files Used by main.py

### Core Entry Point

- **main.py** - Main orchestrator that coordinates the entire scraping process

### Core Dependencies (Direct)

- **config.py** - Configuration settings (TEST_MODE, OUTPUT_DIR, ETHICS_TERMS, etc.)
- **byu_collector.py** - Collects municipal code links from BYU repository
- **parser_factory.py** - Router that selects appropriate parser for each platform
- **pdf_generator.py** - Generates formatted PDFs from scraped content
- **utils.py** - Utility functions (ProgressTracker, extract_state_from_url, extract_city_from_text)

### Platform Parsers (via ParserFactory)

- **municode_parser.py** - Parser for Municipal Code Online (municipalcodeonline.com)
- **municode_library_parser.py** - Parser for Municode Library (library.municode.com)
- **generalcode_parser.py** - Parser for General Code (municipal.codes)
- **amlegal_parser.py** - Parser for Amlegal (amlegal.com)
- **civiclinq_parser.py** - Parser for CivicLinQ
- **codepublishing_parser.py** - Parser for Code Publishing
- **encodeplus_parser.py** - Parser for EncodePlus

### Data Files

- **city_links.json** - Cache of city links (auto-generated by byu_collector)
- **output_pdfs/** - Output directory for generated PDFs

### Configuration/Documentation

- **requirements.txt** - Python package dependencies
- **README.md** - Project documentation
- **.gitignore** - Git ignore rules

## Execution Flow

```
main.py
  ├─> config.py (settings)
  ├─> byu_collector.py
  │     └─> Fetches city links from BYU repository
  │     └─> Saves to city_links.json
  │
  ├─> For each city:
  │     ├─> parser_factory.py
  │     │     └─> Selects appropriate parser based on URL
  │     │     └─> Calls parser.scrape_city()
  │     │
  │     ├─> If ethics content found:
  │     │     └─> pdf_generator.py
  │     │           └─> Generates PDF in output_pdfs/
  │     │
  │     └─> utils.ProgressTracker
  │           └─> Updates progress statistics
  │
  └─> Prints final summary
```

## Command Line Usage

```bash
# Test mode (processes TEST_LIMIT cities from config.py)
python main.py

# Test mode (explicit)
python main.py --test

# Full mode (processes all cities)
python main.py --full

# Force re-collect links from BYU
python main.py --recollect
```

## Key Configuration (config.py)

- `TEST_MODE` - Boolean to enable/disable test mode
- `TEST_LIMIT` - Number of cities to process in test mode
- `OUTPUT_DIR` - Directory for generated PDFs
- `LINKS_CACHE_FILE` - Path to city links cache
- `ETHICS_TERMS` - List of keywords to search for ethics content

## Platform Support

The scraper supports 7 different municipal code platforms:

1. Municipal Code Online (Utah cities)
2. Municode Library (California, Texas cities)
3. General Code
4. Amlegal
5. CivicLinQ
6. Code Publishing
7. EncodePlus

Each platform has its own parser that handles platform-specific HTML structure and navigation.
